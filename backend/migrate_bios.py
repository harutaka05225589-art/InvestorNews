import sqlite3
import os

# Database path
DB_NAME = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'frontend', 'investor_news.db')

def migrate_bios():
    if not os.path.exists(DB_NAME):
        print(f"Database not found at {DB_NAME}")
        return

    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()

    # 1. Add 'profile' column if it doesn't exist
    print("Checking database schema...")
    try:
        c.execute("SELECT profile FROM investors LIMIT 1")
    except sqlite3.OperationalError:
        print("Adding 'profile' column to investors table...")
        c.execute("ALTER TABLE investors ADD COLUMN profile TEXT")

    # 2. Update bios
    bios = {
        "テスタ": """
日本の個人投資家を代表する存在の一人。2005年から株式投資を開始し、スキャルピング（超短期売買）を中心とした手法で資産を拡大。当初はデイトレードがメインだったが、資産規模の拡大に伴い、中長期投資や高配当株投資などへとスタイルを柔軟に変化させている。
X（旧Twitter）やYouTubeでの発信も積極的に行い、初心者への啓蒙活動や投資家同士の交流にも尽力。累計利益は数十億円を超え、その圧倒的なパフォーマンスと誠実な人柄で多くの個人投資家から支持を集めている。
""",
        "藤本茂(シゲルさん)": """
「日本のバフェット」とも称される、88歳（2024年時点）の現役デイトレーダー。19歳で投資を始め、投資歴は69年以上。
神戸の自宅で毎朝2時に起床し、3台のモニターを駆使して日米の市場を監視するスタイルを貫く。資産は20億円に迫る規模だが、「投資は生きがい」として、あくまで現役のプレイヤーであることにこだわり続けている。
メディア出演も多く、その年齢を感じさせないバイタリティと鋭い相場観は、全世代の投資家に大きな影響を与えている。
""",
        "かぶ1000": """
中学生時代から株式投資を始めた、投資歴30年以上のベテラン専業投資家。「資産バリュー株投資」のスペシャリストとして知られる。
企業の保有する現金や不動産などの資産価値に着目し、実質的な価値に対して株価が著しく割安な銘柄（ネットネット株など）を拾う手法を得意とする。
安定した運用成績を残し続け、著書も多数出版。地に足の着いた分析と、徹底したバリュー投資の哲学は、多くの個人投資家の教科書となっている。
""",
        "桐谷広人(桐谷さん)": """
元プロ将棋棋士であり、現在は株主優待投資家としてお茶の間の人気者。「株主優待で生活する男」としてテレビ番組『月曜から夜ふかし』などでブレイク。
約1000銘柄以上の株を保有し、優待券を期限内に使い切るために自転車で疾走する姿がトレードマーク。
しかしその実は、バブル崩壊などの修羅場を乗り越えた経験豊富な投資家であり、配当＋優待利回りを重視した堅実な投資手法は、初心者にも再現性が高く人気がある。
""",
        "片山晃(五月)": """
ハンドルネーム「五月」として知られる著名個人投資家。アルバイトで貯めた65万円を元手に株式投資を開始し、数百億円規模の資産を築き上げたレジェンド。
中小型の成長株への集中投資を得意とし、企業のビジネスモデルや成長ストーリーを徹底的に分析するファンダメンタルズ分析に定評がある。
現在はベンチャーキャピタル業務なども手掛け、日本のスタートアップ育成にも貢献している。
""",
        "井村俊哉": """
元お笑い芸人という異色の経歴を持つ投資家。「株に人生を捧げる男」として知られ、1日10時間以上を銘柄分析に費やす徹底的なリサーチが武器。
三井松島HDへの集中投資で大株主になったことでも話題に。企業業績の変化率やカタリスト（株価変動のきっかけ）を重視し、確信度の高い銘柄に集中投資するスタイル。
その分析の深さと熱量は、機関投資家をも凌駕すると評価されている。
""",
        "cis": """
「一人の力で日経平均を動かせる男」と呼ばれる伝説の個人投資家。230億円以上の資産を持つと言われる。
徹底した順張り（トレンドフォロー）の短期売買が得意。「上がっている株を買い、下がっている株を売る」というシンプルな哲学を極限まで突き詰めている。
ジェイコム株大量誤発注事件での巨額利益など数々の伝説を持ち、海外メディアからも注目される、まさに相場の本能だけで戦う天才型トレーダー。
""",
        "DAIBOUCHOU": """
2000年代の不動産流動化銘柄ブームなどで資産を大きく増やした後、ライブドアショックで大きな資産減を経験。そこから復活を遂げた不屈の投資家。
現在は「割安成長株」への分散投資を主軸とし、PERやPBRなどの指標と成長性のバランスを重視する。
自身の失敗経験に基づいたリスク管理の重要性を説いており、信用取引のリスクやポートフォリオ管理について、実体験に基づいた有益な発信を行っている。
""",
        "かんち": """
高配当株と株主優待株を中心とした投資スタイルで、数億円の資産を築いた兼業投資家（現在は専業）。
不動産投資も手掛けるなど、安定したキャッシュフロー（不労所得）を重視するスタイルが特徴。
優待品が届く様子や配当金の入金報告など、投資の「果実」を楽しむライフスタイルをXなどで発信し、FIRE（経済的自立）を目指す層からの支持が厚い。
""",
        "kenmo": """
イベントドリブン投資や需給分析を得意とする凄腕投資家。
TOB（株式公開買い付け）や公募増資、指数組み入れなど、株価に明確な影響を与えるイベントが発生した際の需給の歪みを狙い撃つスタイル。
市場のルールや制度の隙間を突くような鋭い視点を持ち、短期〜中期で確実に利益を積み上げる職人肌のトレーダー。
""",
        "成長株テリー": """
中小型の成長株投資をメインとする投資家。企業の成長ポテンシャルを見抜き、株価が数倍〜数十倍になる「テンバガー（10倍株）」候補の発掘に情熱を注ぐ。
決算書や開示情報の分析に加え、経営者のビジョンや市場環境の変化を読み解く定性的な分析も重視している。
具体的な銘柄分析や相場見通しの発信は、成長株投資を志す個人投資家にとって貴重な情報源となっている。
""",
         "弍億貯男": """
割安成長株への中長期投資で、サラリーマンを続けながら資産2億円（現在はそれ以上）を達成した「サラリーマン投資家の星」。
「10倍株より2倍株を数回繰り返す」「損切りは早く」など、会社員でも無理なく続けられる堅実なルールを提唱。
著書『10万円から始める! 割安成長株で2億円』はベストセラーとなり、時間を味方につける複利運用の重要性を説き続けている。
""",
         "テンバガー投資家X": """
名前の通り、株価10倍（テンバガー）を狙える超成長株への投資に特化した投資家。
時価総額が小さく、かつ革新的なビジネスモデルや強力な商品を持つ企業を早期に発掘するスタイル。
チャート分析とファンダメンタルズ分析を組み合わせ、大化けする前兆を捉えることを得意としている。具体的な銘柄選定基準などの発信も人気。
"""
    }

    print("Updating investor profiles...")
    for name, profile in bios.items():
        # Update exact matches
        c.execute("UPDATE investors SET profile = ? WHERE name = ?", (profile.strip(), name))
        if c.rowcount > 0:
            print(f"Updated profile for: {name}")
        else:
            print(f"Skipped (Login not found): {name}")

    conn.commit()
    conn.close()
    print("Migration complete.")

if __name__ == "__main__":
    migrate_bios()

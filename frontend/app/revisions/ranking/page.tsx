"use client";

import React, { useState, useEffect } from 'react';
import styles from '../revisions.module.css';

// Revisions Ranking Page (Weekly Price Surge)
interface WeeklyRankingItem {
    rank: number;
    ticker: string;
    name: string;
    change_pct: number;
}

export default function RevisionRankingPage() {
    const [ranking, setRanking] = useState<WeeklyRankingItem[]>([]);
    const [updatedAt, setUpdatedAt] = useState<string>('');
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        // Load static JSON generated by backend
        fetch('/data/weekly_ranking.json')
            .then(res => res.json())
            .then(data => {
                if (data.ranking) {
                    setRanking(data.ranking);
                    setUpdatedAt(data.updated_at);
                }
            })
            .catch(err => console.error("Failed to load ranking", err))
            .finally(() => setLoading(false));
    }, []);

    return (
        <main className={styles.container}>
            <header className={styles.header}>
                <h1 className={styles.title}>
                    ğŸ† ä»Šé€±ã®çˆ†ä¸Šã’ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                </h1>
                <p className={styles.subtitle}>
                    ä»Šé€±ã€æ¥­ç¸¾ä¿®æ­£ã‚’ç™ºè¡¨ã—ãŸéŠ˜æŸ„ã®ä¸­ã§<strong>æ ªä¾¡ä¸Šæ˜‡ç‡ãŒé«˜ã‹ã£ãŸéŠ˜æŸ„</strong>ã®ãƒˆãƒƒãƒ—20ã§ã™ã€‚
                    <br />
                    <span style={{ fontSize: '0.8rem', opacity: 0.7 }}>æ›´æ–°: {updatedAt} (æ¯é€±åœŸæ›œæ›´æ–°)</span>
                </p>
                <div style={{ marginTop: '1rem' }}>
                    <a href="/revisions" style={{ fontSize: '0.9rem', color: 'var(--accent)', textDecoration: 'underline' }}>
                        &larr; ä¿®æ­£ä¸€è¦§ã«æˆ»ã‚‹
                    </a>
                </div>
            </header>

            <section>
                <div className={styles.tableContainer}>
                    <table className={styles.table}>
                        <thead>
                            <tr>
                                <th>é †ä½</th>
                                <th>ã‚³ãƒ¼ãƒ‰</th>
                                <th>éŠ˜æŸ„å</th>
                                <th>é€±é–“é¨°è½ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {ranking.map((item) => (
                                <tr key={item.ticker}>
                                    <td>
                                        <span style={{
                                            display: 'inline-block',
                                            width: '28px', height: '28px',
                                            background: item.rank <= 3 ? '#fbbf24' : '#334155',
                                            color: item.rank <= 3 ? '#000' : '#fff',
                                            borderRadius: '50%', textAlign: 'center', lineHeight: '28px',
                                            fontWeight: 'bold'
                                        }}>
                                            {item.rank}
                                        </span>
                                    </td>
                                    <td>
                                        <a href={`https://finance.yahoo.co.jp/quote/${item.ticker}.T`} target="_blank" rel="noopener noreferrer" className={styles.tickerLink}>
                                            {item.ticker}
                                        </a>
                                    </td>
                                    <td>{item.name}</td>
                                    <td style={{ fontWeight: 'bold', color: item.change_pct > 0 ? '#4ade80' : '#f87171' }}>
                                        {item.change_pct > 0 ? '+' : ''}{item.change_pct}%
                                    </td>
                                </tr>
                            ))}

                            {loading && (
                                <tr>
                                    <td colSpan={4} style={{ textAlign: 'center', padding: '2rem' }}>èª­ã¿è¾¼ã¿ä¸­...</td>
                                </tr>
                            )}

                            {!loading && ranking.length === 0 && (
                                <tr>
                                    <td colSpan={4} style={{ textAlign: 'center', padding: '2rem' }}>
                                        ç¾åœ¨ãƒ‡ãƒ¼ã‚¿åé›†ä¸­ã§ã™ã€‚<br />åœŸæ›œæ—¥ã®æœ10æ™‚ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    );
}
